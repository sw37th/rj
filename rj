#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""Record the TV program by JOB scheduler

Usage:
  rj [-h] add CH TITLE DATE TIME [RECORDINGTIME]
  rj [-h] list [DATE]
  rj [-h] show JOBID
  rj [-h] modbegin JOBID (DELTATIME | DATE TIME)

Options:
  -h --help   show this screen.

"""

from docopt import docopt
from recordjob.RecordJobTorque import RecordJobTorque
from recordjob.rj_utils import parse_time, parse_date, print_jobinfo, parse_time_delta

default_rectime = '00:29:30'

args = docopt(__doc__)
rec = RecordJobTorque()

if args['add']:
    """
    録画ジョブを追加する
    """

    if args['RECORDINGTIME']:
        rectime = args['RECORDINGTIME']
    else:
        rectime = default_rectime

    jid = rec.add(args['CH'], args['TITLE'], args['DATE'], args['TIME'], rectime)
    if jid:
        chinfo = rec.get_channel_info()
        jobinfo = rec.get_job_info(jid=jid)
        print_jobinfo(jobinfo, chinfo)

elif args['list']:
    """
    スケジュールされた録画ジョブを一覧表示する
    """
    date = None
    if args['DATE']:
        date = parse_date(args['DATE'])
        if not date:
            print('invalit format', args['DATE'])
            exit()

    chinfo = rec.get_channel_info()
    jobinfo = rec.get_job_info(date=date)
    print_jobinfo(jobinfo, chinfo)

elif args['show']:
    """
    引数に指定されたIDのジョブを表示する
    """
    chinfo = rec.get_channel_info()
    jobinfo = rec.get_job_info(jid=args['JOBID'])
    print_jobinfo(jobinfo, chinfo)

elif args['modbegin']:
    """
    録画ジョブの開始時間を変更する
    """
    if args['DELTATIME']:
        time_delta = parse_time_delta(args['DELTATIME'])

        if time_delta:
            jobinfo = rec.get_job_info(jid=args['JOBID'])
            chinfo = rec.get_channel_info()
            # before modify
            print_jobinfo(jobinfo, chinfo)
            rec.mod_begintime(jobinfo, time_delta)
            # after modify
            print_jobinfo(jobinfo, chinfo, '(Start time modified)')
    else:
        print("not implemented yet")
        print("rec.mod_begintime({}, {}, {})".format(
            args['JOBID'],
            args['DATE'],
            args['TIME']))

